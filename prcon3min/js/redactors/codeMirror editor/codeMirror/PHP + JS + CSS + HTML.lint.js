!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("htmlhint"),require("php-parser")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","htmlhint","php-parser"],e):e(CodeMirror,window.HTMLHint,PhpParser)}(function(p,f,l){"use strict";var w={"tagname-lowercase":!0,"attr-lowercase":!0,"attr-value-double-quotes":!0,"doctype-first":!1,"tag-pair":!0,"spec-char-escape":!0,"id-unique":!0,"src-not-empty":!0,"attr-no-duplication":!0},e=[];if(f&&!f.verify&&(f=f.HTMLHint),f||(f=window.HTMLHint),!f)return window.console&&window.console.error("Error: window.HTMLHint not found, CodeMirror HTML mixed linting cannot run."),e;if(!window.CSSLint)return window.console&&window.console.error("Error: window.CSSLint not defined, CodeMirror HTML mixed linting cannot run."),e;if(!window.JSHINT)return window.console&&window.console.error("Error: window.JSHINT not defined, CodeMirror HTML mixed linting cannot run."),[];function c(e,r,n){for(var i=0;i<e.length;i++){var o=e[i];if(o){if(o.line<=0){window.console&&window.console.warn("Cannot display JSHint error (invalid line "+o.line+")",o);continue}var t=o.character-1,s=t+1;if(o.evidence){var a=o.evidence.substring(t).search(/.\b/);-1<a&&(s+=a)}var l=o.line-1+n-1,c={message:o.reason,severity:o.code&&o.code.startsWith("W")?"warning":"error",from:p.Pos(l,t),to:p.Pos(l,s)};r.push(c)}}}function m(e){return e.split("\n").length}function d(e,r,n,i,o){var t,s;n.lineNumber&&n.columnNumber?(t=p.Pos(e-1+n.lineNumber-1,n.columnNumber-1),s=p.Pos(e-1+n.lineNumber-1,n.columnNumber)):n.start&&n.end&&(n.end.offset<n.start.offset?(s=p.Pos(e-1+n.start.line-1,n.start.column),t=p.Pos(e-1+n.end.line-1,n.end.column)):(t=p.Pos(e-1+n.start.line-1,n.start.column),s=p.Pos(e-1+n.end.line-1,n.end.column))),o.push({message:r,severity:i,from:t,to:s})}function u(r,e,n,i){for(var o in e.hasOwnProperty("kind")&&function(e,r,n,i){if(n.disableEval){if("eval"===r.kind)return d(e,"Eval is evil",r.loc,"warning",i);if("call"===r.kind&&"create_function"===r.what.name)return d(e,"Eval is evil",r.loc,"warning",i)}if("exit"===r.kind&&n.disableExit)return d(e,"You should not use exit or die",r.loc,"warning",i);if(n.disablePHP7&&"array"===r.kind&&r.shortForm)return d(e,"PHP 7 feature disabled",r.loc,"warning",i);if(n.disabledFunctions&&"call"===r.kind&&-1<n.disabledFunctions.indexOf(r.what.name))return d(e,'Function "'+r.what.name+'" is not available',r.what.loc,"error",i);if(n.deprecatedFunctions&&"call"===r.kind&&-1<n.deprecatedFunctions.indexOf(r.what.name))d(e,'Function "'+r.what.name+'" is deprecated',r.what.loc,"warning",i)}(r,e,n,i),e)if(e.hasOwnProperty(o)){var t=e[o];if(!t)continue;t.hasOwnProperty("kind")?u(r,t,n,i):Array.isArray(t)?t.forEach(function(e){u(r,e,n,i)}):"object"==typeof t&&u(r,t,n,i)}}p.registerHelper("lint","php",function(e,r){var n=[],i=function(e){var r,n=0,i=e.split(/<\?|\?>/gi),o={};e="";for(var t,s,a=0,l=i.length;a<l;a+=2){n+=void 0!==(r=i[a-1])?m(r):0,t=e.indexOf("\n")<0?0:m(e),s=m(i[a]),e+=i[a];for(var c=0,d=s+1;c<d;c++)o[t+c]=0<n?n-a/2*1:0}return{t:e,o:o}}(e);r.indent||(r.indent=1);var o=r.css||JSON.parse(JSON.stringify(r)),t=r.js||JSON.parse(JSON.stringify(r)),s=r.html||JSON.parse(JSON.stringify(r)),a=r.php||JSON.parse(JSON.stringify(r));return t.esversion=6,function(e,r,n){for(var i=e.t,o=f.verify(i,r&&r.rules||w),t=0,s=0;s<o.length;s++){var a=o[s],l=(t=e.o[a.line]||t)+a.line-1,c=t+a.line-1,d=a.col-1,u=a.col;n.push({from:p.Pos(l,d),to:p.Pos(c,u),message:a.message,severity:a.type})}}(i,s,n),function(e,r,n){for(var i=e.t.split(/<style[\s\S]*?>|<\/style>/gi),o=0,t=1;t<i.length;t+=2){var s=m(i.slice(0,t).join()),a=CSSLint.verify(i[t],r).messages,l=null;o=e.o[s]||o;for(var c=0;c<a.length;c++){var d=o+s-1+(l=a[c]).line-1,u=o+s-1+l.line-1,f=l.col-1,w=l.col;n.push({from:p.Pos(d,f),to:p.Pos(u,w),message:l.message,severity:l.type})}}}(i,o,n),function(e,r,n){if(l){var i,o,t=l.parseCode(e,{parser:{suppressErrors:!0},ast:{withPositions:!0}});if(t.messages,t.errors&&0<t.errors.length)for(var s=0;s<t.errors.length;s++)i=(o=t.errors[s]).loc,d(1,o.message,i,"error",n);u(1,t,r,n)}else window.console&&window.console.error("Error: php-parser not defined, CodeMirror PHP linting cannot run.")}(e,a,n),function(e,r,n){for(var i=e.t.split(/<script[\s\S]*?>|<\/script>/gi),o=1;o<i.length;o+=2)if(1<i[o].length){JSHINT(i[o],r,r.globals);var t=JSHINT.data().errors,s=m(i.slice(0,o).join());t&&c(t,n,s+e.o[s])}}(i,t,n),n})});