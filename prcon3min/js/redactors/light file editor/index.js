A.include("js",[CUR_REDACTOR_PATH+"style.js",CUR_REDACTOR_PATH+"src.js"]),A.include("css",CUR_REDACTOR_PATH+"style.css"),function(d){var a={setText:function(e,t,o){(t=PATH(t||e.attrFromPath("_url")).fixUrl())in d.BUFFER.redactors&&(d.BUFFER.redactors[t].child(".lFileTextFrame").contentDocument.body.querySelector("textarea").value=o)},setFromFile:function(t,o){o=PATH(o||t.attrFromPath("_url")).fixUrl();var r=d.BUFFER.redactors[o];UI.setLSToPlace(r.child(".backcontent"),!0),PATH(o,UI.errors).common("getContent").wait(function(e){return UI.setLSToPlace(r.child(".backcontent"),!1),0===e?0:"ok"!==(e=e[0]).type?(UI.errors([e.info]),0):void a.setText(t,o,e.content)}).error(console.error)},edit:function(t,o,e){if((o=PATH(o||t.attrFromPath("_url")).fixUrl())in d.BUFFER.redactors)return o in BUFFER.windows.redactors?a.windowed.edit(t,o):void UI.dialogPanel({content:[{type:"message",text:"reload file?".tr},{type:"button",btntext:"yes".tr,btnID:"y"},{type:"button",btntext:"no".tr,btnID:"n"}],onEnter:"y",func:function(e){"y"===e.pressed&&(UI.toTopFileRedactor(t,o),a.setFromFile(t,o))}});var r=UI.setSrcToPlace("lightFileRedactor"),n=r.child(".lFileTextFrame").contentDocument.body,i=d.A.createElem("textarea",{_CSS:JS_STYLE.lightFileRedactor.textarea});d.BUFFER.redactors[o]=r,n.appendChild(i),i.addEventListener("keydown",function(e){e.keyCode===d.A._DATA.BJSListeners.keyCodes_spec.tab&&(n.parentNode.parentNode.execCommand("insertText",!1,"\t"),StopEvent(e)())}),r.opt("_url",o),void 0===e?a.setFromFile(t,o):a.setText(t,o,e)},windowed:{setText:function(e,t,o){(t=PATH(t||e.attrFromPath("_url")).fixUrl())in d.BUFFER.redactors&&t in d.BUFFER.windows.redactors&&(d.BUFFER.windows.redactors[t].A(".LFEW_TextArea").val=o)},setFromFile:function(t,o){if((o=PATH(o||t.attrFromPath("_url")).fixUrl())in d.BUFFER.redactors&&o in d.BUFFER.windows.redactors){d.BUFFER.redactors[o];var r=BUFFER.windows.redactors[o];r.UI.setLSToPlace("body",!0),PATH(o,r.UI.errors).common("getContent").wait(function(e){return r.UI.setLSToPlace("body",!1),0===e?0:"ok"!==(e=e[0]).type?(r.UI.errors([e.info]),0):void a.windowed.setText(t,o,e.content)}).error(console.error)}},save:function(e,t){if((t=PATH(t||e.attrFromPath("_url")).fixUrl())in d.BUFFER.redactors&&t in d.BUFFER.windows.redactors){var o=BUFFER.windows.redactors[t];o.UI.setLSToPlace("body",!0),PATH(t,UI.errors).common("setContent",{content:o.A(".LFEW_TextArea").val()}).wait(function(e){return o.UI.setLSToPlace("body",!1),0===e?0:"ok"!==(e=e[0]).type?(UI.errors([e.info]),0):void 0})}},attention:function(e,t){if((t=PATH(t||e.attrFromPath("_url")).fixUrl())in BUFFER.redactors&&t in BUFFER.windows.redactors){var o=BUFFER.windows.redactors[t],r=!1,n=["****",o.A(".LFEW_Title").html()],i=function(){r=!0,o.A.not("mousemove",i),o.A.not("mousedown",i),o.A(".LFEW_Title").html=n[1]},a=1;o.A.on("mousemove",i),o.A.on("mousedown",i),d.blur(),o.focus(),function e(){if(r)return o.A(".LFEW_Title").html=n[1];a=a<1?1:0,o.A(".LFEW_Title").html=n[a],setTimeout(e,600)}()}},edit:function(t,o,r){var e=!1;if((o=PATH(o||t.attrFromPath("_url")).fixUrl())in BUFFER.redactors){if(o in BUFFER.windows.redactors)return a.windowed.attention(t,o),void BUFFER.windows.redactors[o].UI.dialogPanel({content:[{type:"message",text:"reload file?".tr},{type:"button",btntext:"yes".tr,btnID:"y"},{type:"button",btntext:"no".tr,btnID:"n"}],onEnter:"y",func:function(e){"y"===e.pressed&&a.windowed.setFromFile(t,o)}});r=BUFFER.redactors[o].child(".lFileTextFrame").contentDocument.body.querySelector("textarea").value,e=!0}var n=d.open("about:blank");if(!n)return UI.errors(["no pop-up"]);e&&BUFFER.redactors[o].remElem(),delete BUFFER.redactors[o],n.thisUrl=o,n.rObj=a,n.document.open("about:blank").write(d.JS_SRC.lightFileRedactorWindowed),n.document.close();var i=n.document.body;if(BUFFER.windows.redactors[o]&&BUFFER.windows.redactors[o]!==n)return n.close();n.window.addEventListener("unload",function(e){!n.allowRClose&&a.close(!1,o)}),BUFFER.windows.redactors[o]=n,BUFFER.redactors[o]=i,function e(){if(!n.opened)return setTimeout(e,1);void 0===r?a.windowed.setFromFile(t,o):a.windowed.setText(t,o,r),n.A(".LFEW_Title").html=PATH(o).name}()},unwindowed:function(e,t){if((t=PATH(t||e.attrFromPath("_url")).fixUrl())in BUFFER.redactors&&t in BUFFER.windows.redactors){var o=BUFFER.windows.redactors[t];o.allowRClose=!0,a.close(!1,t),a.edit(!1,t,o.A(".LFEW_TextArea").val())}}},save:function(e,t){t=PATH(t||e.attrFromPath("_url")).fixUrl();var o=BUFFER.redactors[t],r=o.child(".lFileTextFrame").contentDocument.body.querySelector("textarea");UI.setLSToPlace(o.child(".backcontent"),!0),PATH(t,UI.errors).common("setContent",{content:r.value}).wait(function(e){return UI.setLSToPlace(o.child(".backcontent"),!1),0===e?0:"ok"!==(e=e[0]).type?(UI.errors([e.info]),0):void 0})},close:function(e,t){t=PATH(t||e.attrFromPath("_url")).fixUrl(),e&&UI.easyCancel(e),d.BUFFER.windows.redactors[t]&&(d.BUFFER.windows.redactors[t].allowUnload=!0,d.BUFFER.windows.redactors[t].close()),delete d.BUFFER.redactors[t],delete d.BUFFER.windows.redactors[t]}};d.FILE_REDACTOR=a}(window);